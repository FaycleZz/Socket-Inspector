# Project Overview

This is a browser extension built with WXT that allows the user to debug WebSocket connections on a host page. It displays the WebSocket connections initiated from the host page. For each connection, it displays all the sent and received messages. It also allows the user to create custom messages and send them to the client or server. Currently only supports Chrome, but will support Firefox in the future.

## Important Definitions

**message**: Data sent or received by a WebSocket. `WebSocket` objects have methods for sending messages to the server and subscribing to messages received from the server.

**incoming message**: A WebSocket message sent from the server to the client. Also can be called a "received message".

**outgoing message**: A WebSocket message sent from the client to the server. Also can be called a "sent message".

**packet**: A piece of JSON data sent between the major extension components. Packet schemas are defined in the [sharedTypes file](../utils/sharedTypes/sharedTypes.ts)

## Extension Architecture

The extension contains these major components:

- [Devtools Panel](../entrypoints/devtools-panel):
  - Contains the user interface
  - Sends the user's custom WebSocket messages to the Extension Service Worker via packets
  - Receives packets containing WebSocket information from the Extension Service Worker
- [Extension Service Worker](../entrypoints/background.ts):
  - Sits in the background waiting for a Content Script or Devtools Panel to connect
  - Relays packets between the Devtools Panel and the Content Script once both parties are connected
  - If multiple browser tabs are open, there can be multiple devtools panels and content scripts connected to the extension service worker.
  - Only relays packets from a content script to a devtools panel with the same tabId, and vice versa.
- [Content Script](../entrypoints/contentScript.content.ts):
  - Browser automatically injects the content script into the host page
  - Manually injects the Injected Script into the host page
  - Relays packets between the Extension Service Worker and the Injected Script
- [Injected Script](../entrypoints/injectedScript.ts):
  - Patches the host page's WebSocket constructor via `@mswjs/interceptors`
  - Uses `@mswjs/interceptors` to capture information about the host page's WebSockets (server url, connection status, sent/received messages, etc) and sends it to the content script via packets
  - Receives packets containing the user's custom WebSocket messages from the content script and delivers them to the client or server using `@mswjs/interceptors`
- [Popup](../entrypoints/popup)
  - Allows the user to enable or disable the extension
  - Saves the user's response using `storage.local`

## Folder Structure

This project conforms to WXT's suggested folder structure

- `.output/`: All build artifacts will go here.
- `.wxt/`: Generated by WXT, it contains TS config
- `assets/`: Contains all CSS, images, and other assets that should be processed by WXT
- `components/`: Contains the React components used in the extension's UI
- `components/shadcn`: Contains reusable components from the shadcn component library. These should never be modified.
- `entrypoints/`: Contains the major components of the extension mentioned in the architecture section above
- `hooks/`: React hooks
- `playwright/`: Contains the extension's e2e tests
- `public/`: Contains any files you want to copy into the output folder as-is, without being processed by WXT
- `utils/`: Generic utilities

## General Guidelines

- Always prefer the latest stable APIs from the libraries listed in `package.json`.
- Do **not** suggest deprecated, legacy, or unsafe patterns unless explicitly requested.
- Prefer simple and readable code over premature optimizations.

## React Guidelines

- This project uses the latest version of React (version 19+). Recommend and generate code using the latest React features where relevant.
- This project uses the **React Compiler**. Assume Reactâ€™s compiler provides rendering optimizations.
- Do **not** suggest unnecessary micro-optimizations for rendering performance (e.g., `useMemo`, `useCallback`, `React.memo`) unless they are semantically required for correctness.
- Components should follow follow WCAG 2.1 AA digital-accessibility guidelines
- NEVER use `forwardRef` since it is no longer needed in React 19. Pass ref as a prop instead.
